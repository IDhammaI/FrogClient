/*
 * Decompiled with CFR 0.152.
 * 
 * Could not load the following classes:
 *  net.minecraft.network.packet.Packet
 *  net.minecraft.network.packet.c2s.common.ResourcePackStatusC2SPacket
 *  net.minecraft.network.packet.c2s.common.ResourcePackStatusC2SPacket$Status
 *  net.minecraft.network.packet.s2c.common.ResourcePackSendS2CPacket
 */
package dev.gzsakura_miitong.mod.modules.impl.exploit;

import dev.gzsakura_miitong.api.events.eventbus.EventListener;
import dev.gzsakura_miitong.api.events.impl.PacketEvent;
import dev.gzsakura_miitong.api.events.impl.UpdateEvent;
import dev.gzsakura_miitong.mod.modules.Module;
import net.minecraft.network.packet.Packet;
import net.minecraft.network.packet.c2s.common.ResourcePackStatusC2SPacket;
import net.minecraft.network.packet.s2c.common.ResourcePackSendS2CPacket;

public class NoResourcePack
extends Module {
    public static NoResourcePack INSTANCE;
    private boolean confirm;
    private boolean accepted;
    private int delay;

    public NoResourcePack() {
        super("NoResourcePack", Module.Category.Exploit);
        this.setChinese("\u53cd\u8d44\u6e90\u5305");
        INSTANCE = this;
    }

    @EventListener
    public void onPacketReceive(PacketEvent.Receive e) {
        if (e.getPacket() instanceof ResourcePackSendS2CPacket) {
            this.confirm = true;
            this.accepted = false;
            this.delay = 0;
            e.cancel();
        }
    }

    @EventListener
    public void onUpdate(UpdateEvent event) {
        if (this.confirm) {
            ++this.delay;
            if (this.delay > 15 && !this.accepted) {
                mc.getNetworkHandler().sendPacket((Packet)new ResourcePackStatusC2SPacket(NoResourcePack.mc.player.getUuid(), ResourcePackStatusC2SPacket.Status.ACCEPTED));
                this.accepted = true;
            }
            if (this.delay > 40) {
                mc.getNetworkHandler().sendPacket((Packet)new ResourcePackStatusC2SPacket(NoResourcePack.mc.player.getUuid(), ResourcePackStatusC2SPacket.Status.SUCCESSFULLY_LOADED));
                this.confirm = false;
            }
        }
    }
}

